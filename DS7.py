ì½˜í…ì¸ ë¡œ ê±´ë„ˆë›°ê¸°
ì±„íŒ… ê¸°ë¡

ë‚˜ì˜ ë§:
KPI Master Small 12M KR


ì—…ë¡œë“œí•œ íŒŒì¼ì„ ë¦¬ë·°í•©ë‹ˆë‹¤.
ChatGPTì˜ ë§:
ì—…ë¡œë“œí•˜ì‹  KPI Master ë°ì´í„°ì…‹ì„ ë¦¬ë·°í–ˆìŠµë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

ğŸ“Š ë°ì´í„° ê°œìš”
í–‰(row) ìˆ˜: 3,456ê°œ

ì—´(column) ìˆ˜: 33ê°œ

ê¸°ê°„: ì›”(ì›”) ë‹¨ìœ„ ë°ì´í„°

ë¶„ë¥˜ ê¸°ì¤€: ì‚¬ì—…ë¶€, ì§€ì—­, ì±„ë„, ì œí’ˆì¹´í…Œê³ ë¦¬, ê³ ê°ì„¸ê·¸ë¨¼íŠ¸

ğŸ“‘ ì£¼ìš” ì»¬ëŸ¼
ë§ˆì¼€íŒ…/ì„¸ì¼ì¦ˆ í¼ë„:

ë…¸ì¶œìˆ˜, í´ë¦­ìœ¨, í´ë¦­ìˆ˜, ì„¸ì…˜ìˆ˜, ì „í™˜ìœ¨, ì£¼ë¬¸ìˆ˜, íŒë§¤ë‹¨ìœ„ìˆ˜

ì¬ë¬´ ì„±ê³¼:

í‰ê· ë‹¨ê°€, ë§¤ì¶œì•¡, ë§¤ì¶œì›ê°€, ë§¤ì¶œì´ì´ìµ, ë§ˆì¼€íŒ…ë¹„ìš©, ìš´ì˜ë¹„ìš©, ì˜ì—…ì´ìµ, ê°ë‹¨ê°€

ê³ ê° ê²½í—˜ ì§€í‘œ:

ë°˜í’ˆìœ¨, ë°˜í’ˆê¸ˆì•¡, ì´íƒˆìœ¨, NPS, CSAT

ìš´ì˜ ì„±ê³¼:

ì¬ê³ ìˆ˜ëŸ‰, ë¦¬ë“œíƒ€ì„_ì¼, ì£¼ë¬¸ì´í–‰ìœ¨, ì •ì‹œë°°ì†¡ìœ¨

ê³ ê° ì§€ì›:

ì§€ì›í‹°ì¼“ìˆ˜, í‰ê· í•´ê²°ì‹œê°„_ì‹œê°„, SLAìœ„ë°˜ê±´ìˆ˜

âœ… ë°ì´í„° í’ˆì§ˆ
ê²°ì¸¡ì¹˜ ì—†ìŒ (ëª¨ë“  ì»¬ëŸ¼ì—ì„œ 0ê°œ í™•ì¸)

ì •ë¦¬ëœ KPI ê¸°ì¤€ì— ë”°ë¼ ì¼ê´€ì„± ìˆê²Œ ê´€ë¦¬ë¨

ğŸ§ ìƒ˜í”Œ ë°ì´í„° (2024ë…„ 8ì›”, Retail / Seoul / Direct)
ê³ ê°ì„¸ê·¸ë¨¼íŠ¸	ë§¤ì¶œì•¡	ì˜ì—…ì´ìµ	NPS	CSAT	ì •ì‹œë°°ì†¡ìœ¨	SLAìœ„ë°˜ê±´ìˆ˜
Mass	376,007	-2,216,676	65	4.48	87.9%	0
Affinity	343,114	-425,557	39	4.58	89.1%	0
VIP	256,753	-1,049,031	35	5.00	90.1%	0
B-Pro Mass	453,718	-2,430,085	49	3.41	96.4%	1
B-Pro Affinity	1,670,145	-833,019	49	4.34	90.5%	2
ğŸ“Œ ì¸ì‚¬ì´íŠ¸ ì˜ˆì‹œ
ì˜ì—…ì´ìµ ëŒ€ë¶€ë¶„ ì ì: íŠ¹íˆ ìš´ì˜ë¹„ìš©ì´ ë§¤ìš° ì»¤ì„œ ëª¨ë“  ì„¸ê·¸ë¨¼íŠ¸ì—ì„œ ì ì ë°œìƒ.

ê³ ê° ê²½í—˜ ì§€í‘œ(NPS, CSAT)ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ì–‘í˜¸: ì¼ë¶€ ì„¸ê·¸ë¨¼íŠ¸ëŠ” ë†’ì€ CSAT(5.0) ê¸°ë¡.

ìš´ì˜ ì„±ê³¼ëŠ” ëŒ€ì²´ë¡œ ì•ˆì •ì : ì •ì‹œë°°ì†¡ìœ¨ì´ 90% ì „í›„, SLA ìœ„ë°˜ì€ ì†Œìˆ˜.

ì„¸ê·¸ë¨¼íŠ¸ë³„ ë§¤ì¶œ ì°¨ì´ í¼: B-Pro ì œí’ˆêµ°ì´ ë§¤ì¶œ ê·œëª¨ëŠ” í¬ì§€ë§Œ ì˜ì—…ì´ìµì€ ì—¬ì „íˆ ì ì.

ì›í•˜ì‹œë©´:

ğŸ“ˆ ì›”ë³„ ì¶”ì„¸ ë¶„ì„ (ë§¤ì¶œ, ì´ìµ, ê³ ê°ê²½í—˜)

ğŸ·ï¸ ì„¸ê·¸ë¨¼íŠ¸/ì±„ë„ë³„ ì„±ê³¼ ë¹„êµ

âš ï¸ ì ì ìš”ì¸ ë¶„ì„ (ë¹„ìš© êµ¬ì¡° ì¤‘ì‹¬)

ğŸ¯ ì¶”ì²œ KPI Dashboard êµ¬ì¡° ì„¤ê³„

ì´ ì¤‘ ì–´ë–¤ ë¶€ë¶„ë¶€í„° ì‹¬ì¸µ ë¶„ì„í•´ë“œë¦´ê¹Œìš”? 

ë‚˜ì˜ ë§:
ì±„ë„ë³„ ë§¤ì¶œì•¡ëŒ€ë¹„ ë§¤ì¶œì›ê°€ìœ¨, ë§¤ì¶œì´ì´ìµìœ¨, ìš´ì˜ë¹„ìœ¨, ì˜ì—…ì´ìµë¥ ì„ ê³„ì‚°í•´ì£¼ì„¸ìš”
ChatGPTì˜ ë§:
ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ìš”ì•½


ì±„ë„ë³„ ë§¤ì¶œ ëŒ€ë¹„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ì„ ê³„ì‚°í•´ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ í‘œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§¤ì¶œì›ê°€ìœ¨: ë§¤ì¶œì•¡ ëŒ€ë¹„ ë§¤ì¶œì›ê°€ ë¹„ì¤‘

ë§¤ì¶œì´ì´ìµìœ¨: ë§¤ì¶œì•¡ ëŒ€ë¹„ ë§¤ì¶œì´ì´ìµ ë¹„ì¤‘

ìš´ì˜ë¹„ìœ¨: ë§¤ì¶œì•¡ ëŒ€ë¹„ ìš´ì˜ë¹„ìš© ë¹„ì¤‘

ì˜ì—…ì´ìµë¥ : ë§¤ì¶œì•¡ ëŒ€ë¹„ ì˜ì—…ì´ìµ ë¹„ì¤‘

ğŸ“Š ë°ì´í„°ëŠ” ì´ë¯¸ ì‹œê°í™”ëœ í…Œì´ë¸”ë¡œ ì œê³µí•´ë“œë ¸ìŠµë‹ˆë‹¤.

ğŸ” ì£¼ìš” ì¸ì‚¬ì´íŠ¸
ë§¤ì¶œì›ê°€ìœ¨

ëª¨ë“  ì±„ë„ì´ 62~63% ìˆ˜ì¤€ìœ¼ë¡œ ê±°ì˜ ë™ì¼.

ì¦‰, ì›ê°€ êµ¬ì¡°ëŠ” ì±„ë„ë³„ ì°¨ì´ê°€ ê±°ì˜ ì—†ìŒ.

ë§¤ì¶œì´ì´ìµìœ¨

ì•½ 37% ë‚´ì™¸ë¡œ ë™ì¼í•œ ìˆ˜ì¤€.

ìš´ì˜ë¹„ìœ¨

Partner ì±„ë„ì´ ê°€ì¥ ë†’ìŒ (314.7%)

ë°˜ë©´ Marketplace ì±„ë„ì€ 199.3%ë¡œ ê°€ì¥ ë‚®ìŒ.

â†’ MarketplaceëŠ” ìƒëŒ€ì ìœ¼ë¡œ íš¨ìœ¨ì ì¸ ìš´ì˜ êµ¬ì¡°.

ì˜ì—…ì´ìµë¥ 

ëª¨ë“  ì±„ë„ì´ ì ì êµ¬ì¡°

**Marketplace (-181.9%)**ê°€ ê°€ì¥ ì–‘í˜¸,

**Partner (-299.6%)**ëŠ” ì†ì‹¤ë¥ ì´ ê°€ì¥ í¼.

ì›í•˜ì‹œë©´ ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ğŸ“ˆ ì±„ë„ë³„ ì†ìµ êµ¬ì¡° ë¹„êµ ê·¸ë˜í”„ë¥¼ ê·¸ë ¤ë“œë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‹œê°í™” ì›í•˜ì‹¤ê¹Œìš”? 

ë‚˜ì˜ ë§:
ì±„ë„ë³„ ì†ìµêµ¬ì¡° ë¹„êµ ê·¸ë˜í”„ë¥¼ ê·¸ë ¤ì£¼ì„¸ìš”
ChatGPTì˜ ë§:
ì±„ë„ë³„ ì†ìµêµ¬ì¡° ë¹„êµ




ì¶œë ¥ ì´ë¯¸ì§€
ì—¬ê¸° ì±„ë„ë³„ ì†ìµêµ¬ì¡° ë¹„êµ ê·¸ë˜í”„ë¥¼ ì‹œê°í™”í–ˆìŠµë‹ˆë‹¤ ğŸ“Š

**ë§¤ì¶œì›ê°€ìœ¨(íŒŒë€ìƒ‰)**ê³¼ **ë§¤ì¶œì´ì´ìµìœ¨(ì£¼í™©ìƒ‰)**ì€ ëª¨ë“  ì±„ë„ì´ ìœ ì‚¬í•œ ìˆ˜ì¤€ (ì›ê°€ ì•½ 62~63%, ì´ì´ìµ ì•½ 37%).

**ìš´ì˜ë¹„ìœ¨(ì´ˆë¡ìƒ‰)**ì€ Partner ì±„ë„ì´ ê°€ì¥ ë†’ì•„ êµ¬ì¡°ì ìœ¼ë¡œ ë¹„íš¨ìœ¨ì ì„.

**ì˜ì—…ì´ìµë¥ (ë¹¨ê°„ìƒ‰)**ì€ ì „ ì±„ë„ì—ì„œ ìŒìˆ˜(ì ì) ìƒíƒœì´ë©°, ê·¸ì¤‘ Marketplaceê°€ ìƒëŒ€ì ìœ¼ë¡œ ì†ì‹¤ì´ ê°€ì¥ ì ìŒ.

ì›í•˜ì‹œë©´ ì´ ê·¸ë˜í”„ë¥¼ í¼ë„ ë¶„ì„ í˜•íƒœë¡œ ë°”ê¾¸ê±°ë‚˜, ì‹œê°„(ì›”ë³„) ì¶”ì„¸ë¡œ í™•ì¥í•´ì„œ ë³¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. â¡ï¸ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ë” ë¶„ì„í•´ë“œë¦´ê¹Œìš”? 

ë‚˜ì˜ ë§:
ì±„ë„ë³„ ë§¤ì¶œì›ê°€ìœ¨, ë§¤ì¶œì´ì´ìµë¥ , ìš´ì˜ë¹„ìš©ë¥ ì„ ê·¸ë˜í”„ë¡œ ê·¸ë ¤ì£¼ì„¸ìš”
ChatGPTì˜ ë§:
ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìœ¨)




ì¶œë ¥ ì´ë¯¸ì§€
ì—¬ê¸° ì±„ë„ë³„ ë§¤ì¶œì›ê°€ìœ¨, ë§¤ì¶œì´ì´ìµë¥ , ìš´ì˜ë¹„ìš©ë¥ ì„ ë¹„êµí•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤ ğŸ“Š

ë§¤ì¶œì›ê°€ìœ¨ê³¼ ë§¤ì¶œì´ì´ìµë¥ ì€ ëª¨ë“  ì±„ë„ì´ ê±°ì˜ ë™ì¼í•œ ìˆ˜ì¤€ (ì›ê°€ìœ¨ ì•½ 62~63%, ì´ì´ìµë¥  ì•½ 37%).

ìš´ì˜ë¹„ìš©ë¥ ì€ ì±„ë„ë³„ ì°¨ì´ê°€ í¼:

MarketplaceëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì•„ íš¨ìœ¨ì  (ì•½ 200%).

PartnerëŠ” ê°€ì¥ ë†’ì•„ 314% ì´ìƒìœ¼ë¡œ ë¹„íš¨ìœ¨ì  êµ¬ì¡°.

ì´ì œ ì›í•˜ì‹œë©´, ì œê°€ ì´ ë¹„ìœ¨ì„ **íŠ¸ë Œë“œ(ì›”ë³„ ë³€í™”)**ë¡œë„ ì‹œê°í™”í•´ë“œë¦´ê¹Œìš”? 

ë‚˜ì˜ ë§:
ìš´ì˜ë¹„ìš©ë¥ ì´ ê°€ì¥ ë†’ì€ ê·¸ë˜í”„ì— ë ˆì´ë¸”ì„ ë‹¬ì•„ì£¼ì‹œê³ , ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”
ìš´ì˜ë¹„ìš©ë¥  í‰ê· ê°’ì„ ê·¸ë˜í”„ì— ì¶”ê°€í•´ì£¼ì„¸ìš”
ChatGPTì˜ ë§:
ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìœ¨)




ì¶œë ¥ ì´ë¯¸ì§€
ì™„ë£Œí–ˆìŠµë‹ˆë‹¤ âœ…

**ìš´ì˜ë¹„ìš©ë¥ ì´ ê°€ì¥ ë†’ì€ ì±„ë„(Partner)**ì˜ ë§‰ëŒ€ë¥¼ ë¶‰ì€ìƒ‰ìœ¼ë¡œ í‘œì‹œí•˜ê³ , ê°’ ë ˆì´ë¸”ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

ì „ì²´ **ìš´ì˜ë¹„ìš©ë¥  í‰ê· (íšŒìƒ‰ ì ì„ )**ì„ ê·¸ë˜í”„ì— í‘œì‹œí–ˆìŠµë‹ˆë‹¤.

ì´ì œ ì±„ë„ë³„ ìš´ì˜ íš¨ìœ¨ì„±ì„ í•œëˆˆì— ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›í•˜ì‹œë©´ ê° ì±„ë„ì˜ ì›”ë³„ ìš´ì˜ë¹„ìš©ë¥  ì¶”ì„¸ë„ ë¶„ì„í•´ë“œë¦´ê¹Œìš”? 

ë‚˜ì˜ ë§:
ìœ„ ì‘ì—…ì„ ìë™í™” í•˜ê² ìŠµë‹ˆë‹¤.
 
ì—…ë¡œë“œ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
ì‹¤í–‰í™˜ê²½ : íŒŒì´ì°¸
ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¤‘ ê°€ì¥ ìµœì‹  íŠ¸ë Œë“œì— ë§ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•´ì£¼ì„¸ìš”.
ê¸€ê¼´ì€ ë§‘ì€ ê³ ë”• ê¸€ê¼´ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
**ì„¤ì¹˜ ì½”ë“œë¥¼ í¬í•¨í•œ ì „ì²´ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.**
ChatGPTì˜ ë§:

17s ë™ì•ˆ ìƒê°í•¨
ì¢‹ì•„ìš”! PyCharm í™˜ê²½ì—ì„œ ì—…ë¡œë“œí•œ CSVë¥¼ ìë™ìœ¼ë¡œ ì½ê³ , ì±„ë„ë³„ë¡œ
ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìš©ë¥ ì„ ê³„ì‚°Â·ì‹œê°í™”(ìµœê³  ìš´ì˜ë¹„ìš©ë¥  ë¶‰ì€ìƒ‰+ë ˆì´ë¸”, í‰ê· ì„  í‘œì‹œ)í•˜ëŠ” ì™„ì „ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë“œë¦´ê²Œìš”.
ì°¨íŠ¸ëŠ” ìµœì‹  íŠ¸ë Œë“œì— ë§ì¶° Plotly(ì¸í„°ë™í‹°ë¸Œ)ë¡œ ë§Œë“¤ê³ , ê¸€ê¼´ì€ ë§‘ì€ ê³ ë”•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

1) ì„¤ì¹˜ ì½”ë“œ (í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰)
# ê¶Œì¥: ê°€ìƒí™˜ê²½ ìƒì„±(ì„ íƒ)
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
# source .venv/bin/activate

# í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
pip install --upgrade pip
pip install pandas plotly kaleido
kaleidoëŠ” Plotly ì°¨íŠ¸ë¥¼ PNGë¡œ ì €ì¥í•  ë•Œ í•„ìš”í•©ë‹ˆë‹¤.

2) ì‚¬ìš© ë°©ë²•
ë°©ë²• A (íŒŒì¼ ì„ íƒ ëŒ€í™”ìƒì): python kpi_channel_metrics.py

ë°©ë²• B (íŒŒì¼ ê²½ë¡œ ì§ì ‘ ì§€ì •): python kpi_channel_metrics.py --file "C:\ê²½ë¡œ\KPI_Master_Small_12M_KR.csv"

ì‹¤í–‰í•˜ë©´:

channel_profitability_ratios.html (ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸)

channel_profitability_ratios.png (ì •ì  ì´ë¯¸ì§€)

channel_ratio_summary.csv (ì±„ë„ë³„ ë¹„ìœ¨ ìš”ì•½ í…Œì´ë¸”)
ì´ 3ê°œ ê²°ê³¼ íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤.

3) ì „ì²´ ì½”ë“œ: kpi_channel_metrics.py
import argparse
import os
import sys
import pandas as pd
import plotly.graph_objects as go
import plotly.express as px

# ------------------------------------------------------------
# ì„¤ì •
# ------------------------------------------------------------
APP_TITLE = "ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìš©ë¥ )"
OUTPUT_HTML = "channel_profitability_ratios.html"
OUTPUT_PNG = "channel_profitability_ratios.png"
OUTPUT_CSV = "channel_ratio_summary.csv"

# Plotly í°íŠ¸ ì„¤ì •: ë§‘ì€ ê³ ë”• ìš°ì„ , ë¯¸ì„¤ì¹˜ í™˜ê²½ì„ ëŒ€ë¹„í•´ ëŒ€ì²´ í°íŠ¸ ì§€ì •
FONT_FAMILY = "Malgun Gothic, ë§‘ì€ ê³ ë”•, AppleGothic, Noto Sans CJK KR, Noto Sans KR, Arial"

# ------------------------------------------------------------
# ìœ í‹¸: íŒŒì¼ ì„ íƒ(ì„ íƒí˜•)
# ------------------------------------------------------------
def pick_file_dialog():
    try:
        import tkinter as tk
        from tkinter import filedialog
        root = tk.Tk()
        root.withdraw()
        path = filedialog.askopenfilename(
            title="KPI CSV íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”",
            filetypes=[("CSV files", "*.csv"), ("All files", "*.*")]
        )
        return path
    except Exception:
        return None

# ------------------------------------------------------------
# ë°ì´í„° ë¡œë“œ
# ------------------------------------------------------------
def load_data(csv_path: str) -> pd.DataFrame:
    if not os.path.exists(csv_path):
        raise FileNotFoundError(f"íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {csv_path}")
    df = pd.read_csv(csv_path, encoding="utf-8")
    return df

# ------------------------------------------------------------
# ê²€ì¦
# ------------------------------------------------------------
REQUIRED_COLS = ["ì±„ë„", "ë§¤ì¶œì•¡", "ë§¤ì¶œì›ê°€", "ë§¤ì¶œì´ì´ìµ", "ìš´ì˜ë¹„ìš©"]

def validate_columns(df: pd.DataFrame):
    missing = [c for c in REQUIRED_COLS if c not in df.columns]
    if missing:
        raise ValueError(f"í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: {missing}\n"
                         f"í•„ìš” ì»¬ëŸ¼: {REQUIRED_COLS}")

# ------------------------------------------------------------
# ê³„ì‚°
# ------------------------------------------------------------
def compute_channel_ratios(df: pd.DataFrame) -> pd.DataFrame:
    # ì±„ë„ë³„ í•©ê³„
    grouped = df.groupby("ì±„ë„", dropna=False).agg({
        "ë§¤ì¶œì•¡": "sum",
        "ë§¤ì¶œì›ê°€": "sum",
        "ë§¤ì¶œì´ì´ìµ": "sum",
        "ìš´ì˜ë¹„ìš©": "sum"
    }).reset_index()

    # 0 ë§¤ì¶œ ì•ˆì „ ì²˜ë¦¬(0ì´ë©´ ë¶„ëª¨ë¥¼ ë§¤ìš° ì‘ì€ ê°’ìœ¼ë¡œ)
    safe_sales = grouped["ë§¤ì¶œì•¡"].replace(0, 1e-12)

    grouped["ë§¤ì¶œì›ê°€ìœ¨"] = grouped["ë§¤ì¶œì›ê°€"] / safe_sales
    grouped["ë§¤ì¶œì´ì´ìµë¥ "] = grouped["ë§¤ì¶œì´ì´ìµ"] / safe_sales
    grouped["ìš´ì˜ë¹„ìš©ë¥ "] = grouped["ìš´ì˜ë¹„ìš©"] / safe_sales

    # ë³´ê¸° ì¢‹ê²Œ ì •ë ¬(ë§¤ì¶œì•¡ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
    grouped = grouped.sort_values("ë§¤ì¶œì•¡", ascending=False).reset_index(drop=True)

    return grouped

# ------------------------------------------------------------
# ì‹œê°í™” (Plotly)
# ------------------------------------------------------------
def build_chart(df_ratio: pd.DataFrame):
    categories = df_ratio["ì±„ë„"].astype(str).tolist()

    cost_ratio = df_ratio["ë§¤ì¶œì›ê°€ìœ¨"].tolist()
    gross_ratio = df_ratio["ë§¤ì¶œì´ì´ìµë¥ "].tolist()
    op_ratio = df_ratio["ìš´ì˜ë¹„ìš©ë¥ "].tolist()

    # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ€ ì±„ë„ í•˜ì´ë¼ì´íŠ¸(ë¹¨ê°„ìƒ‰)
    max_idx = int(pd.Series(op_ratio).idxmax())
    colors_op = []
    for i, _ in enumerate(op_ratio):
        colors_op.append("red" if i == max_idx else "#636EFA")  # Plotly ê¸°ë³¸ íŒ”ë ˆíŠ¸ ì¤‘ íŒŒë‘ ëŒ€ì²´

    # í‰ê· ì„ 
    op_avg = float(pd.Series(op_ratio).mean())

    fig = go.Figure()

    # ë§¤ì¶œì›ê°€ìœ¨
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì›ê°€ìœ¨",
        x=categories,
        y=cost_ratio,
        offsetgroup=0,
        marker=dict(line=dict(width=0)),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì›ê°€ìœ¨=%{y:.2f}<extra></extra>"
    ))

    # ë§¤ì¶œì´ì´ìµë¥ 
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì´ì´ìµë¥ ",
        x=categories,
        y=gross_ratio,
        offsetgroup=1,
        marker=dict(line=dict(width=0)),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì´ì´ìµë¥ =%{y:.2f}<extra></extra>"
    ))

    # ìš´ì˜ë¹„ìš©ë¥  (ìµœëŒ€ê°’ ë¶‰ì€ìƒ‰ + ë ˆì´ë¸”)
    # textëŠ” ìµœëŒ€ê°’ì—ë§Œ í‘œì‹œ
    text_vals = ["" for _ in op_ratio]
    text_vals[max_idx] = f"{op_ratio[max_idx]:.2f}"

    fig.add_trace(go.Bar(
        name="ìš´ì˜ë¹„ìš©ë¥ ",
        x=categories,
        y=op_ratio,
        offsetgroup=2,
        marker=dict(color=colors_op),
        text=text_vals,
        textposition="outside",
        cliponaxis=False,
        hovertemplate="ì±„ë„=%{x}<br>ìš´ì˜ë¹„ìš©ë¥ =%{y:.2f}<extra></extra>"
    ))

    # í‰ê· ì„ 
    fig.add_hline(y=op_avg, line_dash="dash", line_color="gray", annotation_text=f"ìš´ì˜ë¹„ìš©ë¥  í‰ê· : {op_avg:.2f}")

    # ë ˆì´ì•„ì›ƒ
    fig.update_layout(
        title=dict(text=APP_TITLE, x=0.5),
        xaxis_title="ì±„ë„",
        yaxis_title="ë¹„ìœ¨",
        barmode="group",
        bargap=0.25,
        bargroupgap=0.08,
        legend_title_text="ì§€í‘œ",
        template="plotly_white",
        font=dict(family=FONT_FAMILY),
        margin=dict(l=60, r=40, t=80, b=60),
        hoverlabel=dict(font_family=FONT_FAMILY)
    )

    # y=0 ê¸°ì¤€ì„  ê°•ì¡°
    fig.add_hline(y=0, line_width=1, line_color="black")

    return fig

# ------------------------------------------------------------
# ì €ì¥
# ------------------------------------------------------------
def save_outputs(fig: go.Figure, df_ratio: pd.DataFrame):
    # HTML(ì¸í„°ë™í‹°ë¸Œ)
    fig.write_html(OUTPUT_HTML, include_plotlyjs="cdn")
    # PNG(ì •ì ) - kaleido í•„ìš”
    try:
        fig.write_image(OUTPUT_PNG, scale=2, width=1200, height=700)
    except Exception as e:
        print(f"[ê²½ê³ ] PNG ì €ì¥ ì‹¤íŒ¨(ì•„ë§ˆë„ kaleido ë¯¸ì„¤ì¹˜/í°íŠ¸ë¬¸ì œ): {e}")
    # ìš”ì•½ í…Œì´ë¸” CSV
    # ì†Œìˆ˜ì  6ìë¦¬ ê³ ì •(ì›í•˜ë©´ ë³€ê²½)
    df_export = df_ratio.copy()
    for col in ["ë§¤ì¶œì›ê°€ìœ¨", "ë§¤ì¶œì´ì´ìµë¥ ", "ìš´ì˜ë¹„ìš©ë¥ "]:
        df_export[col] = df_export[col].round(6)
    df_export.to_csv(OUTPUT_CSV, index=False, encoding="utf-8-sig")

# ------------------------------------------------------------
# ë©”ì¸
# ------------------------------------------------------------
def main():
    parser = argparse.ArgumentParser(description="ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ìë™í™” ìŠ¤í¬ë¦½íŠ¸")
    parser.add_argument("--file", type=str, help="ì…ë ¥ CSV íŒŒì¼ ê²½ë¡œ (ì˜ˆ: KPI_Master_Small_12M_KR.csv)")
    args = parser.parse_args()

    csv_path = args.file
    if not csv_path:
        csv_path = pick_file_dialog()
    if not csv_path:
        print("CSV íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. --file ì˜µì…˜ìœ¼ë¡œ ê²½ë¡œë¥¼ ì§€ì •í•˜ê±°ë‚˜ íŒŒì¼ ì„ íƒì°½ì—ì„œ ì„ íƒí•˜ì„¸ìš”.")
        sys.exit(1)

    print(f"[ì •ë³´] íŒŒì¼ ë¡œë“œ: {csv_path}")
    df = load_data(csv_path)
    validate_columns(df)

    print("[ì •ë³´] ì±„ë„ë³„ ë¹„ìœ¨ ê³„ì‚° ì¤‘...")
    df_ratio = compute_channel_ratios(df)

    print("[ì •ë³´] ì°¨íŠ¸ ìƒì„± ì¤‘...")
    fig = build_chart(df_ratio)

    print(f"[ì •ë³´] ê²°ê³¼ ì €ì¥: {OUTPUT_HTML}, {OUTPUT_PNG}, {OUTPUT_CSV}")
    save_outputs(fig, df_ratio)

    print("[ì™„ë£Œ] ìƒì„±ëœ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”:")
    print(f" - {os.path.abspath(OUTPUT_HTML)}")
    print(f" - {os.path.abspath(OUTPUT_PNG)}")
    print(f" - {os.path.abspath(OUTPUT_CSV)}")

if __name__ == "__main__":
    main()
ë©”ëª¨ / ìì£¼ ë¬»ëŠ” ì´ìŠˆ
í°íŠ¸(ë§‘ì€ ê³ ë”•): WindowsëŠ” ê¸°ë³¸ ë‚´ì¥. macOS/Linuxì—ì„œ ë§‘ì€ ê³ ë”•ì´ ì—†ë‹¤ë©´ ëŒ€ì²´ í°íŠ¸(AppleGothic/Noto Sans KR)ê°€ ì ìš©ë©ë‹ˆë‹¤. ë§‘ì€ ê³ ë”•ì„ ë°˜ë“œì‹œ ì“°ë ¤ë©´ ì‹œìŠ¤í…œì— ì„¤ì¹˜ í›„ ì¬ì‹¤í–‰í•˜ì„¸ìš”.

PNG ì €ì¥ ì˜¤ë¥˜: kaleido ë¯¸ì„¤ì¹˜ ë˜ëŠ” í°íŠ¸ ë¯¸ì„¤ì¹˜ ì‹œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. pip install kaleido í›„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.

ì—´ ì´ë¦„ ë¶ˆì¼ì¹˜: ìŠ¤í¬ë¦½íŠ¸ëŠ” ì±„ë„, ë§¤ì¶œì•¡, ë§¤ì¶œì›ê°€, ë§¤ì¶œì´ì´ìµ, ìš´ì˜ë¹„ìš© ì»¬ëŸ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¦„ì´ ë‹¤ë¥´ë©´ CSVì—ì„œ í•´ë‹¹ ì—´ëª…ì„ ë§ì¶°ì£¼ì„¸ìš”.

í•„ìš”í•˜ì‹œë©´ ì›”ë³„ ì¶”ì„¸ ìë™í™” ìŠ¤í¬ë¦½íŠ¸(ì‹œê³„ì—´ ë¼ì¸ì°¨íŠ¸)ë‚˜ ì—¬ëŸ¬ íŒŒì¼ ë°°ì¹˜ ì²˜ë¦¬ ë²„ì „ë„ ë§Œë“¤ì–´ ë“œë¦´ê²Œìš”.

ë‚˜ì˜ ë§:
ìŠ¤íŠ¸ë¦¼ë¦¿ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ìˆ˜ì •í•´ ì£¼ì„¸ìš”
ChatGPTì˜ ë§:

13s ë™ì•ˆ ìƒê°í•¨
ì¢‹ìŠµë‹ˆë‹¤! ìŠ¤íŠ¸ë¦¼ë¦¿(Streamlit)ìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œ ì•± í˜•íƒœë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
CSV ì—…ë¡œë“œ â†’ ì±„ë„ë³„ ë§¤ì¶œì›ê°€ìœ¨/ë§¤ì¶œì´ì´ìµë¥ /ìš´ì˜ë¹„ìš©ë¥  ê³„ì‚° â†’ ìµœê³  ìš´ì˜ë¹„ìš©ë¥  ë¶‰ì€ìƒ‰+ë¼ë²¨, ìš´ì˜ë¹„ìš©ë¥  í‰ê· ì„  í‘œì‹œ ì°¨íŠ¸ + ë‹¤ìš´ë¡œë“œ ë²„íŠ¼(CSV/PNG/HTML)ê¹Œì§€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì°¨íŠ¸ëŠ” Plotly(ìµœì‹  íŠ¸ë Œë“œì˜ ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸)ë¡œ ë§Œë“¤ê³ , í°íŠ¸ëŠ” ë§‘ì€ ê³ ë”•ì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

1) ì„¤ì¹˜ & ì‹¤í–‰
# (ì„ íƒ) ê°€ìƒí™˜ê²½
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
# source .venv/bin/activate

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
pip install --upgrade pip
pip install streamlit pandas plotly kaleido

# ì•± ì‹¤í–‰
streamlit run app.py
kaleidoëŠ” PNG ë‚´ë³´ë‚´ê¸°ì— í•„ìš”í•©ë‹ˆë‹¤.

2) app.py ì „ì²´ ì½”ë“œ
import io
import os
import pandas as pd
import streamlit as st
import plotly.graph_objects as go

# ----------------------------
# í˜ì´ì§€ ì„¤ì •
# ----------------------------
st.set_page_config(
    page_title="ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ",
    page_icon="ğŸ“Š",
    layout="wide",
)

TITLE = "ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìš©ë¥ )"
FONT_FAMILY = "Malgun Gothic, ë§‘ì€ ê³ ë”•, AppleGothic, Noto Sans CJK KR, Noto Sans KR, Arial"
REQUIRED_COLS = ["ì±„ë„", "ë§¤ì¶œì•¡", "ë§¤ì¶œì›ê°€", "ë§¤ì¶œì´ì´ìµ", "ìš´ì˜ë¹„ìš©"]

# ----------------------------
# ì‚¬ì´ë“œë°” - íŒŒì¼ ì—…ë¡œë“œ
# ----------------------------
st.sidebar.header("ğŸ“¥ ë°ì´í„° ì—…ë¡œë“œ")
uploaded_file = st.sidebar.file_uploader("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”", type=["csv"])

st.title("ğŸ“Š ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ")
st.caption("ì—…ë¡œë“œí•œ CSVì—ì„œ ì±„ë„ë³„ ë§¤ì¶œì›ê°€ìœ¨/ë§¤ì¶œì´ì´ìµë¥ /ìš´ì˜ë¹„ìš©ë¥ ì„ ê³„ì‚°í•˜ê³  ì‹œê°í™”í•©ë‹ˆë‹¤.")

def validate_columns(df: pd.DataFrame):
    missing = [c for c in REQUIRED_COLS if c not in df.columns]
    if missing:
        st.error(f"í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: {missing}\ní•„ìš” ì»¬ëŸ¼: {REQUIRED_COLS}")
        st.stop()

@st.cache_data(show_spinner=False)
def load_df(file) -> pd.DataFrame:
    return pd.read_csv(file)

def compute_channel_ratios(df: pd.DataFrame) -> pd.DataFrame:
    # ì±„ë„ë³„ í•©ê³„
    grouped = df.groupby("ì±„ë„", dropna=False).agg({
        "ë§¤ì¶œì•¡": "sum",
        "ë§¤ì¶œì›ê°€": "sum",
        "ë§¤ì¶œì´ì´ìµ": "sum",
        "ìš´ì˜ë¹„ìš©": "sum",
    }).reset_index()

    # ë¶„ëª¨ 0 ë³´í˜¸
    safe_sales = grouped["ë§¤ì¶œì•¡"].replace(0, 1e-12)

    grouped["ë§¤ì¶œì›ê°€ìœ¨"]   = grouped["ë§¤ì¶œì›ê°€"]   / safe_sales
    grouped["ë§¤ì¶œì´ì´ìµë¥ "] = grouped["ë§¤ì¶œì´ì´ìµ"] / safe_sales
    grouped["ìš´ì˜ë¹„ìš©ë¥ "]   = grouped["ìš´ì˜ë¹„ìš©"]   / safe_sales

    # ë³´ê¸° ì¢‹ê²Œ ì •ë ¬ (ë§¤ì¶œì•¡ ë‚´ë¦¼ì°¨ìˆœ)
    grouped = grouped.sort_values("ë§¤ì¶œì•¡", ascending=False).reset_index(drop=True)
    return grouped

def build_chart(df_ratio: pd.DataFrame) -> go.Figure:
    categories = df_ratio["ì±„ë„"].astype(str).tolist()
    cost_ratio = df_ratio["ë§¤ì¶œì›ê°€ìœ¨"].tolist()
    gross_ratio = df_ratio["ë§¤ì¶œì´ì´ìµë¥ "].tolist()
    op_ratio    = df_ratio["ìš´ì˜ë¹„ìš©ë¥ "].tolist()

    # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ€ ì±„ë„ ë¶‰ì€ìƒ‰ ì²˜ë¦¬ + ê°’ ë¼ë²¨
    max_idx = int(pd.Series(op_ratio).idxmax())
    colors_op = ["#636EFA"] * len(op_ratio)  # ê¸°ë³¸ìƒ‰
    colors_op[max_idx] = "red"

    op_avg = float(pd.Series(op_ratio).mean())

    fig = go.Figure()

    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì›ê°€ìœ¨",
        x=categories, y=cost_ratio, offsetgroup=0,
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì›ê°€ìœ¨=%{y:.2f}<extra></extra>"
    ))

    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì´ì´ìµë¥ ",
        x=categories, y=gross_ratio, offsetgroup=1,
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì´ì´ìµë¥ =%{y:.2f}<extra></extra>"
    ))

    text_vals = [""] * len(op_ratio)
    text_vals[max_idx] = f"{op_ratio[max_idx]:.2f}"

    fig.add_trace(go.Bar(
        name="ìš´ì˜ë¹„ìš©ë¥ ",
        x=categories, y=op_ratio, offsetgroup=2,
        marker=dict(color=colors_op),
        text=text_vals, textposition="outside", cliponaxis=False,
        hovertemplate="ì±„ë„=%{x}<br>ìš´ì˜ë¹„ìš©ë¥ =%{y:.2f}<extra></extra>"
    ))

    # í‰ê· ì„ 
    fig.add_hline(y=op_avg, line_dash="dash", line_color="gray",
                  annotation_text=f"ìš´ì˜ë¹„ìš©ë¥  í‰ê· : {op_avg:.2f}",
                  annotation_position="top left")

    fig.update_layout(
        title=dict(text=TITLE, x=0.5),
        xaxis_title="ì±„ë„",
        yaxis_title="ë¹„ìœ¨",
        barmode="group",
        bargap=0.25,
        bargroupgap=0.08,
        legend_title_text="ì§€í‘œ",
        template="plotly_white",
        font=dict(family=FONT_FAMILY),
        margin=dict(l=40, r=40, t=80, b=40),
    )
    fig.add_hline(y=0, line_width=1, line_color="black")
    return fig

def format_ratio_columns(df: pd.DataFrame, pct_cols):
    out = df.copy()
    for c in pct_cols:
        out[c] = (out[c] * 100).map(lambda x: f"{x:,.2f}%")
    return out

# ----------------------------
# ë³¸ë¬¸ UI
# ----------------------------
if uploaded_file is None:
    st.info("ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. (ì˜ˆ: KPI_Master_Small_12M_KR.csv)")
else:
    df = load_df(uploaded_file)
    validate_columns(df)

    # ê³„ì‚°
    ratio_df = compute_channel_ratios(df)

    # ê²°ê³¼ í…Œì´ë¸”
    with st.expander("ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ìš”ì•½ ë°ì´í„°", expanded=True):
        st.dataframe(
            format_ratio_columns(
                ratio_df[["ì±„ë„", "ë§¤ì¶œì›ê°€ìœ¨", "ë§¤ì¶œì´ì´ìµë¥ ", "ìš´ì˜ë¹„ìš©ë¥ "]],
                ["ë§¤ì¶œì›ê°€ìœ¨", "ë§¤ì¶œì´ì´ìµë¥ ", "ìš´ì˜ë¹„ìš©ë¥ "]
            ),
            use_container_width=True
        )

    # ì°¨íŠ¸
    fig = build_chart(ratio_df)
    st.plotly_chart(fig, use_container_width=True)

    # ----------------------------
    # ë‹¤ìš´ë¡œë“œ ì„¹ì…˜
    # ----------------------------
    st.subheader("â¬‡ï¸ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ")

    # CSV
    csv_bytes = ratio_df.to_csv(index=False, encoding="utf-8-sig").encode("utf-8-sig")
    st.download_button(
        label="ì±„ë„ë³„ ë¹„ìœ¨ CSV ë‹¤ìš´ë¡œë“œ",
        data=csv_bytes,
        file_name="channel_ratio_summary.csv",
        mime="text/csv"
    )

    # HTML
    html_bytes = fig.to_html(include_plotlyjs="cdn").encode("utf-8")
    st.download_button(
        label="ì°¨íŠ¸ HTML ë‹¤ìš´ë¡œë“œ",
        data=html_bytes,
        file_name="channel_profitability_ratios.html",
        mime="text/html"
    )

    # PNG (kaleido í•„ìš”)
    try:
        png_bytes = fig.to_image(format="png", width=1400, height=800, scale=2)
        st.download_button(
            label="ì°¨íŠ¸ PNG ë‹¤ìš´ë¡œë“œ",
            data=png_bytes,
            file_name="channel_profitability_ratios.png",
            mime="image/png"
        )
    except Exception as e:
        st.warning("PNG ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ì— 'kaleido'ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.")
        if os.environ.get("STREAMLIT_DEBUG", "0") == "1":
            st.exception(e)

# í‘¸í„°
st.caption("Â© ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ â€¢ Plotly + Streamlit â€¢ í°íŠ¸: ë§‘ì€ ê³ ë”• ìš°ì„  ì ìš©")
ì¶”ê°€ íŒ
ë§‘ì€ ê³ ë”• ê¸€ê¼´: Windows ê¸°ë³¸ ë‚´ì¥ì…ë‹ˆë‹¤. macOS/Linuxì—ì„œëŠ” AppleGothic ë˜ëŠ” Noto Sans KRë¡œ ìë™ ëŒ€ì²´ë©ë‹ˆë‹¤. ë°˜ë“œì‹œ ë§‘ì€ ê³ ë”•ì„ ì“°ë ¤ë©´ ì‹œìŠ¤í…œì— ì„¤ì¹˜ í›„ ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ì„¸ìš”.

ì»¬ëŸ¼ëª…: ìŠ¤í¬ë¦½íŠ¸ëŠ” ì±„ë„, ë§¤ì¶œì•¡, ë§¤ì¶œì›ê°€, ë§¤ì¶œì´ì´ìµ, ìš´ì˜ë¹„ìš© ì»¬ëŸ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ë¦„ì´ ë‹¤ë¥´ë©´ CSVì—ì„œ ì¼ì¹˜ì‹œì¼œì£¼ì„¸ìš”.

ëŒ€ìš©ëŸ‰ ë°ì´í„°: ê·¸ë£¹ë°” ì°¨íŠ¸ì—ì„œ ì±„ë„ ìˆ˜ê°€ ë§ì„ ê²½ìš° ìŠ¤í¬ë¡¤ì„ ìœ„í•´ Streamlit ë ˆì´ì•„ì›ƒì„ wideë¡œ ë‘ì—ˆìœ¼ë©°, í•„ìš” ì‹œ ìƒìœ„ Nê°œë§Œ í•„í„°ë§í•˜ëŠ” ì˜µì…˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì´ ì•±ì— ì›”ë³„ ì¶”ì„¸(ë¼ì¸ ì°¨íŠ¸) íƒ­, ì±„ë„/ì§€ì—­/ì œí’ˆì¹´í…Œê³ ë¦¬ í•„í„°ë„ íƒ­ í˜•íƒœë¡œ í™•ì¥í•´ë“œë¦´ê²Œìš”.

ë‚˜ì˜ ë§:

ë§‰ëŒ€ê·¸ë˜í”„ ê¸°ë³¸ìƒ‰ì„ ë§¤ì¶œì›ê°€ìœ¨ì€ 048BA8, ë§¤ì¶œì´ì´ìµë¥ ì€ EFEA5A / ìš´ì˜ë¹„ìš©ë¥  F29E4C ë¡œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
ChatGPTì˜ ë§:
ì¢‹ìŠµë‹ˆë‹¤ ğŸ‘
ìŠ¤íŠ¸ë¦¼ë¦¿ìš© ì½”ë“œì—ì„œ ë§‰ëŒ€ê·¸ë˜í”„ ìƒ‰ìƒì„ ì§ì ‘ ì§€ì •í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
ìš”ì²­í•˜ì‹  ìƒ‰ìƒê°’ì€ ë‹¤ìŒê³¼ ê°™ì´ ì ìš©ë©ë‹ˆë‹¤:

ë§¤ì¶œì›ê°€ìœ¨ â†’ #048BA8 (íŒŒë€í†¤)

ë§¤ì¶œì´ì´ìµë¥  â†’ #EFEA5A (ì˜…ì€ ë…¸ë€í†¤)

ìš´ì˜ë¹„ìš©ë¥  â†’ #F29E4C (ì£¼í™©í†¤, ë‹¨ ìµœëŒ€ ìš´ì˜ë¹„ìš©ë¥  ì±„ë„ë§Œ ë¶‰ì€ìƒ‰ ìœ ì§€)

ìˆ˜ì •ëœ ë¶€ë¶„ (ì°¨íŠ¸ ìƒì„± í•¨ìˆ˜)
def build_chart(df_ratio: pd.DataFrame) -> go.Figure:
    categories = df_ratio["ì±„ë„"].astype(str).tolist()
    cost_ratio = df_ratio["ë§¤ì¶œì›ê°€ìœ¨"].tolist()
    gross_ratio = df_ratio["ë§¤ì¶œì´ì´ìµë¥ "].tolist()
    op_ratio    = df_ratio["ìš´ì˜ë¹„ìš©ë¥ "].tolist()

    # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ€ ì±„ë„ ë¶‰ì€ìƒ‰ ì²˜ë¦¬ + ê°’ ë¼ë²¨
    max_idx = int(pd.Series(op_ratio).idxmax())
    colors_op = ["#F29E4C"] * len(op_ratio)   # ê¸°ë³¸ ì£¼í™©ìƒ‰
    colors_op[max_idx] = "red"                # ìµœëŒ“ê°’ë§Œ ë¶‰ì€ìƒ‰

    op_avg = float(pd.Series(op_ratio).mean())

    fig = go.Figure()

    # ë§¤ì¶œì›ê°€ìœ¨
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì›ê°€ìœ¨",
        x=categories, y=cost_ratio, offsetgroup=0,
        marker=dict(color="#048BA8"),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì›ê°€ìœ¨=%{y:.2f}<extra></extra>"
    ))

    # ë§¤ì¶œì´ì´ìµë¥ 
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì´ì´ìµë¥ ",
        x=categories, y=gross_ratio, offsetgroup=1,
        marker=dict(color="#EFEA5A"),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì´ì´ìµë¥ =%{y:.2f}<extra></extra>"
    ))

    # ìš´ì˜ë¹„ìš©ë¥ 
    text_vals = [""] * len(op_ratio)
    text_vals[max_idx] = f"{op_ratio[max_idx]:.2f}"

    fig.add_trace(go.Bar(
        name="ìš´ì˜ë¹„ìš©ë¥ ",
        x=categories, y=op_ratio, offsetgroup=2,
        marker=dict(color=colors_op),
        text=text_vals, textposition="outside", cliponaxis=False,
        hovertemplate="ì±„ë„=%{x}<br>ìš´ì˜ë¹„ìš©ë¥ =%{y:.2f}<extra></extra>"
    ))

    # í‰ê· ì„ 
    fig.add_hline(y=op_avg, line_dash="dash", line_color="gray",
                  annotation_text=f"ìš´ì˜ë¹„ìš©ë¥  í‰ê· : {op_avg:.2f}",
                  annotation_position="top left")

    fig.update_layout(
        title=dict(text=TITLE, x=0.5),
        xaxis_title="ì±„ë„",
        yaxis_title="ë¹„ìœ¨",
        barmode="group",
        bargap=0.25,
        bargroupgap=0.08,
        legend_title_text="ì§€í‘œ",
        template="plotly_white",
        font=dict(family=FONT_FAMILY),
        margin=dict(l=40, r=40, t=80, b=40),
    )
    fig.add_hline(y=0, line_width=1, line_color="black")
    return fig
ì´ì œ ì‹¤í–‰í•˜ë©´:

ë§¤ì¶œì›ê°€ìœ¨ ë§‰ëŒ€ëŠ” #048BA8,

ë§¤ì¶œì´ì´ìµë¥  ë§‰ëŒ€ëŠ” #EFEA5A,

ìš´ì˜ë¹„ìš©ë¥  ë§‰ëŒ€ëŠ” ê¸°ë³¸ #F29E4C, ë‹¨ ê°€ì¥ ë†’ì€ ìš´ì˜ë¹„ìš©ë¥  ë§‰ëŒ€ë§Œ ë¶‰ì€ìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì´ ìƒ‰ìƒ íŒ”ë ˆíŠ¸ë¥¼ ì „ì²´ ëŒ€ì‹œë³´ë“œì˜ í†µì¼ëœ ì»¬ëŸ¬ í…Œë§ˆë¡œ í™•ì¥í•´ ë“œë¦´ ìˆ˜ë„ ìˆëŠ”ë°, ê·¸ë ‡ê²Œ í•´ë“œë¦´ê¹Œìš”?

ë‚˜ì˜ ë§:
ëŒ€ì‹œë³´ë“œë¥¼ í†µì¼ëœ ì»¬ëŸ¬ í…Œë§ˆë¡œ ë°”ê¿”ì£¼ì„¸ìš”
ChatGPTì˜ ë§:

20s ë™ì•ˆ ìƒê°í•¨
ì¢‹ìŠµë‹ˆë‹¤! ì•± ì „ì²´ì— í†µì¼ëœ ì»¬ëŸ¬ í…Œë§ˆë¥¼ ì ìš©í•˜ë„ë¡ êµ¬ì„± íŒŒì¼ê³¼ ì½”ë“œ ë‘˜ ë‹¤ ì†ë´¤ìŠµë‹ˆë‹¤.
(ë§‰ëŒ€ ìƒ‰: ì›ê°€ìœ¨ #048BA8, ì´ì´ìµë¥  #EFEA5A, ìš´ì˜ë¹„ìš©ë¥  ê¸°ë³¸ #F29E4C + ìµœëŒ“ê°’ì€ ë¹¨ê°„ìƒ‰ ìœ ì§€)

ì•„ë˜ ë‘ íŒŒì¼ë§Œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì¶”ê°€/êµì²´í•˜ì„¸ìš”.

1) .streamlit/config.toml (ìƒˆë¡œ ìƒì„±)
[theme]
# ë²„íŠ¼/ì²´í¬ë°•ìŠ¤ ë“± í¬ì»¤ìŠ¤ ì»¬ëŸ¬
primaryColor = "#048BA8"

# í˜ì´ì§€ ë°°ê²½
backgroundColor = "#F7F9FB"

# ì¹´ë“œ/ì»¨íŠ¸ë¡¤ ë°°ê²½
secondaryBackgroundColor = "#FFFFFF"

# ê¸°ë³¸ í…ìŠ¤íŠ¸
textColor = "#0F172A"

# ìŠ¤íŠ¸ë¦¼ë¦¿ ì‹œìŠ¤í…œ í°íŠ¸ ì˜µì…˜ (ì°¨íŠ¸ í°íŠ¸ëŠ” ì½”ë“œì—ì„œ 'ë§‘ì€ ê³ ë”•' ì ìš©)
font = "sans serif"
ì´ ì„¤ì •ìœ¼ë¡œ Streamlitì˜ ë²„íŠ¼Â·ì‚¬ì´ë“œë°”Â·ìœ„ì ¯ê¹Œì§€ ì¼ê´€ëœ í†¤ì´ ì ìš©ë©ë‹ˆë‹¤.

2) app.py (êµì²´ìš© ì „ì²´ ì½”ë“œ)
import io
import os
import pandas as pd
import streamlit as st
import plotly.graph_objects as go

# ----------------------------
# í…Œë§ˆ/ìŠ¤íƒ€ì¼ ìƒìˆ˜
# ----------------------------
TITLE = "ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìš©ë¥ )"
FONT_FAMILY = "Malgun Gothic, ë§‘ì€ ê³ ë”•, AppleGothic, Noto Sans CJK KR, Noto Sans KR, Arial"

# í†µì¼ëœ íŒ”ë ˆíŠ¸
CLR_COST = "#048BA8"     # ë§¤ì¶œì›ê°€ìœ¨
CLR_GROSS = "#EFEA5A"    # ë§¤ì¶œì´ì´ìµë¥ 
CLR_OP = "#F29E4C"       # ìš´ì˜ë¹„ìš©ë¥ (ê¸°ë³¸)
CLR_OP_MAX = "red"       # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ“ê°’ ê°•ì¡°
CLR_AXIS = "#0F172A"     # ì¶•/í…ìŠ¤íŠ¸
CLR_GRID = "rgba(15, 23, 42, 0.08)"  # ì—°í•œ ê·¸ë¦¬ë“œ
CLR_AVG = "gray"         # í‰ê· ì„ 

REQUIRED_COLS = ["ì±„ë„", "ë§¤ì¶œì•¡", "ë§¤ì¶œì›ê°€", "ë§¤ì¶œì´ì´ìµ", "ìš´ì˜ë¹„ìš©"]

# ----------------------------
# í˜ì´ì§€ ì„¤ì •
# ----------------------------
st.set_page_config(
    page_title="ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ",
    page_icon="ğŸ“Š",
    layout="wide",
)

# ì•± ì „ì—­ CSS (í°íŠ¸ & ì¹´ë“œ/í‘œ ì—¬ë°± ì¡°ì •)
st.markdown(f"""
<style>
    html, body, [class*="css"] {{
        font-family: {FONT_FAMILY} !important;
    }}
    .block-container {{
        padding-top: 1.5rem;
        padding-bottom: 2rem;
    }}
</style>
""", unsafe_allow_html=True)

# ----------------------------
# ì‚¬ì´ë“œë°” - ì—…ë¡œë“œ
# ----------------------------
st.sidebar.header("ğŸ“¥ ë°ì´í„° ì—…ë¡œë“œ")
uploaded_file = st.sidebar.file_uploader("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”", type=["csv"])

st.title("ğŸ“Š ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ")
st.caption("í†µì¼ëœ ì»¬ëŸ¬ í…Œë§ˆ ì ìš© â€¢ Plotly + Streamlit â€¢ í°íŠ¸: ë§‘ì€ ê³ ë”• ìš°ì„ ")

def validate_columns(df: pd.DataFrame):
    missing = [c for c in REQUIRED_COLS if c not in df.columns]
    if missing:
        st.error(f"í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: {missing}\ní•„ìš” ì»¬ëŸ¼: {REQUIRED_COLS}")
        st.stop()

@st.cache_data(show_spinner=False)
def load_df(file) -> pd.DataFrame:
    return pd.read_csv(file)

def compute_channel_ratios(df: pd.DataFrame) -> pd.DataFrame:
    # ì±„ë„ë³„ í•©ê³„
    grouped = df.groupby("ì±„ë„", dropna=False).agg({
        "ë§¤ì¶œì•¡": "sum",
        "ë§¤ì¶œì›ê°€": "sum",
        "ë§¤ì¶œì´ì´ìµ": "sum",
        "ìš´ì˜ë¹„ìš©": "sum",
    }).reset_index()

    # ë¶„ëª¨ 0 ë³´í˜¸
    safe_sales = grouped["ë§¤ì¶œì•¡"].replace(0, 1e-12)

    grouped["ë§¤ì¶œì›ê°€ìœ¨"]   = grouped["ë§¤ì¶œì›ê°€"]   / safe_sales
    grouped["ë§¤ì¶œì´ì´ìµë¥ "] = grouped["ë§¤ì¶œì´ì´ìµ"] / safe_sales
    grouped["ìš´ì˜ë¹„ìš©ë¥ "]   = grouped["ìš´ì˜ë¹„ìš©"]   / safe_sales

    # ë³´ê¸° ì¢‹ê²Œ ì •ë ¬ (ë§¤ì¶œì•¡ ë‚´ë¦¼ì°¨ìˆœ)
    grouped = grouped.sort_values("ë§¤ì¶œì•¡", ascending=False).reset_index(drop=True)
    return grouped

def build_chart(df_ratio: pd.DataFrame) -> go.Figure:
    categories = df_ratio["ì±„ë„"].astype(str).tolist()
    cost_ratio = df_ratio["ë§¤ì¶œì›ê°€ìœ¨"].tolist()
    gross_ratio = df_ratio["ë§¤ì¶œì´ì´ìµë¥ "].tolist()
    op_ratio    = df_ratio["ìš´ì˜ë¹„ìš©ë¥ "].tolist()

    # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ€ ì±„ë„ ë¶‰ì€ìƒ‰ ì²˜ë¦¬ + ê°’ ë¼ë²¨
    max_idx = int(pd.Series(op_ratio).idxmax())
    colors_op = [CLR_OP] * len(op_ratio)
    colors_op[max_idx] = CLR_OP_MAX

    op_avg = float(pd.Series(op_ratio).mean())

    fig = go.Figure()

    # ë§¤ì¶œì›ê°€ìœ¨
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì›ê°€ìœ¨",
        x=categories, y=cost_ratio, offsetgroup=0,
        marker=dict(color=CLR_COST),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì›ê°€ìœ¨=%{y:.2f}<extra></extra>"
    ))

    # ë§¤ì¶œì´ì´ìµë¥ 
    fig.add_trace(go.Bar(
        name="ë§¤ì¶œì´ì´ìµë¥ ",
        x=categories, y=gross_ratio, offsetgroup=1,
        marker=dict(color=CLR_GROSS),
        hovertemplate="ì±„ë„=%{x}<br>ë§¤ì¶œì´ì´ìµë¥ =%{y:.2f}<extra></extra>"
    ))

    # ìš´ì˜ë¹„ìš©ë¥  (ìµœëŒ“ê°’ ë¼ë²¨)
    text_vals = [""] * len(op_ratio)
    text_vals[max_idx] = f"{op_ratio[max_idx]:.2f}"

    fig.add_trace(go.Bar(
        name="ìš´ì˜ë¹„ìš©ë¥ ",
        x=categories, y=op_ratio, offsetgroup=2,
        marker=dict(color=colors_op),
        text=text_vals, textposition="outside", cliponaxis=False,
        hovertemplate="ì±„ë„=%{x}<br>ìš´ì˜ë¹„ìš©ë¥ =%{y:.2f}<extra></extra>"
    ))

    # í‰ê· ì„ 
    fig.add_hline(
        y=op_avg, line_dash="dash", line_color=CLR_AVG,
        annotation_text=f"ìš´ì˜ë¹„ìš©ë¥  í‰ê· : {op_avg:.2f}",
        annotation_position="top left",
        annotation_font=dict(family=FONT_FAMILY, color=CLR_AVG)
    )

    # ì¶•/ê·¸ë¦¬ë“œ/í°íŠ¸ ë“± ë ˆì´ì•„ì›ƒ ì¼ê´„ í…Œë§ˆ
    fig.update_layout(
        title=dict(text=TITLE, x=0.5, font=dict(family=FONT_FAMILY)),
        xaxis_title="ì±„ë„",
        yaxis_title="ë¹„ìœ¨",
        barmode="group",
        bargap=0.25,
        bargroupgap=0.08,
        legend_title_text="ì§€í‘œ",
        template="plotly_white",
        font=dict(family=FONT_FAMILY, color=CLR_AXIS),
        margin=dict(l=40, r=40, t=80, b=40),
    )
    fig.update_xaxes(showgrid=False, linecolor=CLR_GRID, tickfont=dict(color=CLR_AXIS))
    fig.update_yaxes(showgrid=True, gridcolor=CLR_GRID, zeroline=False, tickfont=dict(color=CLR_AXIS))

    # y=0 ê¸°ì¤€ì„ 
    fig.add_hline(y=0, line_width=1, line_color=CLR_AXIS)

    return fig

def format_ratio_columns(df: pd.DataFrame, pct_cols):
    out = df.copy()
    for c in pct_cols:
        out[c] = (out[c] * 100).map(lambda x: f"{x:,.2f}%")
    return out

# ----------------------------
# ë³¸ë¬¸
# ----------------------------
if uploaded_file is None:
    st.info("ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. (ì˜ˆ: KPI_Master_Small_12M_KR.csv)")
else:
    df = load_df(uploaded_file)
    validate_columns(df)

    ratio_df = compute_channel_ratios(df)

    with st.expander("ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ìš”ì•½ ë°ì´í„°", expanded=True):
        st.dataframe(
            format_ratio_columns(
                ratio_df[["ì±„ë„", "ë§¤ì¶œì›ê°€ìœ¨", "ë§¤ì¶œì´ì´ìµë¥ ", "ìš´ì˜ë¹„ìš©ë¥ "]],
                ["ë§¤ì¶œì›ê°€ìœ¨", "ë§¤ì¶œì´ì´ìµë¥ ", "ìš´ì˜ë¹„ìš©ë¥ "]
            ),
            use_container_width=True
        )

    fig = build_chart(ratio_df)
    st.plotly_chart(fig, use_container_width=True)

    st.subheader("â¬‡ï¸ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ")
    csv_bytes = ratio_df.to_csv(index=False, encoding="utf-8-sig").encode("utf-8-sig")
    st.download_button(
        label="ì±„ë„ë³„ ë¹„ìœ¨ CSV ë‹¤ìš´ë¡œë“œ",
        data=csv_bytes,
        file_name="channel_ratio_summary.csv",
        mime="text/csv",
        type="primary"  # theme.primaryColor ì ìš©
    )

    html_bytes = fig.to_html(include_plotlyjs="cdn").encode("utf-8")
    st.download_button(
        label="ì°¨íŠ¸ HTML ë‹¤ìš´ë¡œë“œ",
        data=html_bytes,
        file_name="channel_profitability_ratios.html",
        mime="text/html"
    )

    # PNG (kaleido í•„ìš”)
    try:
        png_bytes = fig.to_image(format="png", width=1400, height=800, scale=2)
        st.download_button(
            label="ì°¨íŠ¸ PNG ë‹¤ìš´ë¡œë“œ",
            data=png_bytes,
            file_name="channel_profitability_ratios.png",
            mime="image/png"
        )
    except Exception as e:
        st.warning("PNG ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ì— 'kaleido'ê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.")
        if os.environ.get("STREAMLIT_DEBUG", "0") == "1":
            st.exception(e)

st.caption("Â© ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ â€¢ í†µì¼ëœ í…Œë§ˆ â€¢ Plotly + Streamlit â€¢ í°íŠ¸: ë§‘ì€ ê³ ë”• ìš°ì„  ì ìš©")
ì‚¬ìš© íŒ
í…Œë§ˆ ë³€ê²½ì€ .streamlit/config.tomlì—ì„œ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤(ì•± ì¬ì‹¤í–‰/ë¦¬ë¡œë“œ í•„ìš”).

í°íŠ¸: WindowsëŠ” â€˜ë§‘ì€ ê³ ë”•â€™ ê¸°ë³¸ ì§€ì›. macOS/Linuxì—ì„œëŠ” AppleGothic/Noto Sans KRë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.

ì—¬ëŸ¬ ì°¨íŠ¸ íƒ­ êµ¬ì„±(ì›”ë³„ ì¶”ì„¸/ì±„ë„ í•„í„° ë“±)ìœ¼ë¡œ í™•ì¥ ì›í•˜ì‹œë©´ ì•Œë ¤ì£¼ì„¸ìš”. í†µì¼ëœ íŒ”ë ˆíŠ¸ë¡œ ì¼ê´„ ì ìš©í•´ ë“œë¦½ë‹ˆë‹¤.

ë‚˜ì˜ ë§:
1ë²ˆì€ ì–´ë””ì„œ ë¸‰ì´ë‚˜ì—¬?
ChatGPTì˜ ë§:
ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš” ğŸ‘

ì œê°€ ë§ì”€ë“œë¦° 1ë²ˆ .streamlit/config.toml íŒŒì¼ì€, app.py ê°™ì€ ìŠ¤íŠ¸ë¦¼ë¦¿ ì•± ì‹¤í–‰ íŒŒì¼ì´ ìˆëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë” ì•ˆì— ì§ì ‘ ë§Œë“¤ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

ì˜ˆì‹œ êµ¬ì¡°ëŠ” ì´ë ‡ê²Œ ë©ë‹ˆë‹¤:

í”„ë¡œì íŠ¸í´ë”/
 â”œâ”€â”€ app.py              # ìŠ¤íŠ¸ë¦¼ë¦¿ ì•± ì‹¤í–‰ íŒŒì¼
 â”œâ”€â”€ requirements.txt    # (ì„ íƒ) í•„ìš”í•œ íŒ¨í‚¤ì§€ ëª…ì‹œ
 â””â”€â”€ .streamlit/
      â””â”€â”€ config.toml    # â† ì—¬ê¸°!
ì¦‰, .streamlitì´ë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— config.toml íŒŒì¼ì„ ë„£ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.
ì´ ì„¤ì •ì€ Streamlitì´ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì™€ì„œ í…Œë§ˆ(ìƒ‰ìƒ, í°íŠ¸ ë“±)ë¥¼ ì•± ì „ì²´ì— ì ìš©í•©ë‹ˆë‹¤.

ğŸ‘‰ ì •ë¦¬:

app.pyë‘ ê°™ì€ ë ˆë²¨ì— .streamlit í´ë”ë¥¼ ë§Œë“­ë‹ˆë‹¤.

ê·¸ ì•ˆì— config.tomlì„ ì €ì¥í•©ë‹ˆë‹¤.

ì´í›„ streamlit run app.py ì‹¤í–‰í•˜ë©´ í…Œë§ˆê°€ ì ìš©ëœ ìƒíƒœë¡œ ì•±ì´ ëœ¹ë‹ˆë‹¤.

ì›í•˜ì‹œë©´ ì œê°€ .streamlit/config.toml íŒŒì¼ì„ ì§ì ‘ ë§Œë“¤ì–´ë“œë¦´ ìˆ˜ ìˆëŠ” íŒŒì´ì¬ ì½”ë“œë„ ë“œë¦´ê¹Œìš”?

ë‚˜ì˜ ë§:
ì˜ ëª¨ë¥´ê² ì–´ìš”.
ë©”ì¸ì½”ë“œì— ë„£ì–´ì„œ ì£¼ì„¸ìš”
ChatGPTì˜ ë§:
ì•„í•˜ ğŸ‘ ì´í•´í–ˆìŠµë‹ˆë‹¤.
ë³„ë„ì˜ .streamlit/config.toml íŒŒì¼ì„ ë§Œë“œëŠ” ê²Œ ë‚¯ì„¤ë‹¤ë©´, ë©”ì¸ ì½”ë“œ(app.py) ì•ˆì—ì„œ ì§ì ‘ í…Œë§ˆë¥¼ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í•´ë“œë¦´ê²Œìš”.

Streamlitì€ ì‚¬ì‹¤ st.set_page_config + st.markdown CSS ì£¼ì…ìœ¼ë¡œ ì›¬ë§Œí•œ í…Œë§ˆëŠ” í†µì¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì•„ë˜ëŠ” í…Œë§ˆê¹Œì§€ í¬í•¨ëœ í†µí•© ë²„ì „ app.py ì…ë‹ˆë‹¤:

import os
import pandas as pd
import streamlit as st
import plotly.graph_objects as go

# ----------------------------
# í…Œë§ˆ/ìŠ¤íƒ€ì¼ ìƒìˆ˜
# ----------------------------
TITLE = "ì±„ë„ë³„ ì£¼ìš” ì†ìµ ë¹„ìœ¨ (ë§¤ì¶œì›ê°€ìœ¨ / ë§¤ì¶œì´ì´ìµë¥  / ìš´ì˜ë¹„ìš©ë¥ )"
FONT_FAMILY = "Malgun Gothic, ë§‘ì€ ê³ ë”•, AppleGothic, Noto Sans CJK KR, Noto Sans KR, Arial"

# í†µì¼ëœ íŒ”ë ˆíŠ¸
CLR_COST = "#048BA8"     # ë§¤ì¶œì›ê°€ìœ¨
CLR_GROSS = "#EFEA5A"    # ë§¤ì¶œì´ì´ìµë¥ 
CLR_OP = "#F29E4C"       # ìš´ì˜ë¹„ìš©ë¥  ê¸°ë³¸
CLR_OP_MAX = "red"       # ìš´ì˜ë¹„ìš©ë¥  ìµœëŒ“ê°’ ê°•ì¡°
CLR_AXIS = "#0F172A"     # ì¶•/í…ìŠ¤íŠ¸
CLR_GRID = "rgba(15, 23, 42, 0.08)"  # ì—°í•œ ê·¸ë¦¬ë“œ
CLR_AVG = "gray"         # í‰ê· ì„ 

REQUIRED_COLS = ["ì±„ë„", "ë§¤ì¶œì•¡", "ë§¤ì¶œì›ê°€", "ë§¤ì¶œì´ì´ìµ", "ìš´ì˜ë¹„ìš©"]

# ----------------------------
# í˜ì´ì§€ ì„¤ì • (ë©”ì¸ ì½”ë“œì—ì„œ í…Œë§ˆ ì ìš©)
# ----------------------------
st.set_page_config(
    page_title="ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ",
    page_icon="ğŸ“Š",
    layout="wide",
)

# ì „ì—­ ìŠ¤íƒ€ì¼ ì§ì ‘ ì§€ì • (ê¸°ë³¸ ë°°ê²½, ìœ„ì ¯ ìƒ‰ìƒ ë“±)
st.markdown(f"""
<style>
    html, body, [class*="css"] {{
        font-family: {FONT_FAMILY} !important;
        background-color: #F7F9FB;
        color: {CLR_AXIS};
    }}
    .block-container {{
        padding-top: 1.5rem;
        padding-bottom: 2rem;
    }}
    /* ë²„íŠ¼ ìƒ‰ìƒ */
    .stButton button {{
        background-color: {CLR_COST};
        color: white;
        border-radius: 8px;
        border: none;
        padding: 0.5rem 1rem;
    }}
    .stButton button:hover {{
        background-color: #036f84;
        color: white;
    }}
    /* ì‚¬ì´ë“œë°” */
    section[data-testid="stSidebar"] {{
        background-color: #FFFFFF;
    }}
</style>
""", unsafe_allow_html=True)

# ----------------------------
# ì‚¬ì´ë“œë°” - ì—…ë¡œë“œ
# ----------------------------
st.sidebar.header("ğŸ“¥ ë°ì´í„° ì—…ë¡œë“œ")
uploaded_file = st.sidebar.file_uploader("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”", type=["csv"])

st.title("ğŸ“Š ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ")
st.caption("í†µì¼ëœ ì»¬ëŸ¬ í…Œë§ˆ ì ìš© â€¢ Plotly + Streamlit â€¢ í°íŠ¸: ë§‘ì€ ê³ ë”•")

def validate_columns(df: pd.DataFrame):
    missing = [c for c in REQUIRED_COLS if c not in df.columns]
    if missing:
        st.error(f"í•„ìˆ˜ ì»¬ëŸ¼ ëˆ„ë½: {missing}\ní•„ìš” ì»¬ëŸ¼: {REQUIRED_COLS}")
        st.stop()

@st.cache_data(show_spinner=False)
def load_df(file) -> pd.DataFrame:
    return pd.read_csv(file)

def compute_channel_ratios(df: pd.DataFrame) -> pd.DataFrame:
    grouped = df.groupby("ì±„ë„", dropna=False).agg({
        "ë§¤ì¶œì•¡": "sum",
        "ë§¤ì¶œì›ê°€": "sum",
        "ë§¤ì¶œì´ì´ìµ": "sum",
        "ìš´ì˜ë¹„ìš©": "sum",
    }).reset_index()
    safe_sales = grouped["ë§¤ì¶œì•¡"].replace(0, 1e-12)
    grouped["ë§¤ì¶œì›ê°€ìœ¨"]   = grouped["ë§¤ì¶œì›ê°€"]   / safe_sales
    grouped["ë§¤ì¶œì´ì´ìµë¥ "] = grouped["ë§¤ì¶œì´ì´ìµ"] / safe_sales
    grouped["ìš´ì˜ë¹„ìš©ë¥ "]   = grouped["ìš´ì˜ë¹„ìš©"]   / safe_sales
    return grouped.sort_values("ë§¤ì¶œì•¡", ascending=False).reset_index(drop=True)

def build_chart(df_ratio: pd.DataFrame) -> go.Figure:
    categories = df_ratio["ì±„ë„"].astype(str).tolist()
    cost_ratio = df_ratio["ë§¤ì¶œì›ê°€ìœ¨"].tolist()
    gross_ratio = df_ratio["ë§¤ì¶œì´ì´ìµë¥ "].tolist()
    op_ratio    = df_ratio["ìš´ì˜ë¹„ìš©ë¥ "].tolist()

    max_idx = int(pd.Series(op_ratio).idxmax())
    colors_op = [CLR_OP] * len(op_ratio)
    colors_op[max_idx] = CLR_OP_MAX
    op_avg = float(pd.Series(op_ratio).mean())

    fig = go.Figure()
    fig.add_trace(go.Bar(name="ë§¤ì¶œì›ê°€ìœ¨", x=categories, y=cost_ratio,
                         marker=dict(color=CLR_COST)))
    fig.add_trace(go.Bar(name="ë§¤ì¶œì´ì´ìµë¥ ", x=categories, y=gross_ratio,
                         marker=dict(color=CLR_GROSS)))
    fig.add_trace(go.Bar(name="ìš´ì˜ë¹„ìš©ë¥ ", x=categories, y=op_ratio,
                         marker=dict(color=colors_op),
                         text=["" if i != max_idx else f"{op_ratio[i]:.2f}" for i in range(len(op_ratio))],
                         textposition="outside", cliponaxis=False))

    fig.add_hline(y=op_avg, line_dash="dash", line_color=CLR_AVG,
                  annotation_text=f"ìš´ì˜ë¹„ìš©ë¥  í‰ê· : {op_avg:.2f}",
                  annotation_position="top left")

    fig.update_layout(
        title=dict(text=TITLE, x=0.5, font=dict(family=FONT_FAMILY)),
        xaxis_title="ì±„ë„",
        yaxis_title="ë¹„ìœ¨",
        barmode="group",
        template="plotly_white",
        font=dict(family=FONT_FAMILY, color=CLR_AXIS)
    )
    return fig

def format_ratio_columns(df: pd.DataFrame, pct_cols):
    out = df.copy()
    for c in pct_cols:
        out[c] = (out[c] * 100).map(lambda x: f"{x:,.2f}%")
    return out

# ----------------------------
# ë³¸ë¬¸
# ----------------------------
if uploaded_file is None:
    st.info("ì¢Œì¸¡ ì‚¬ì´ë“œë°”ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.")
else:
    df = load_df(uploaded_file)
    validate_columns(df)
    ratio_df = compute_channel_ratios(df)

    with st.expander("ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ìš”ì•½ ë°ì´í„°", expanded=True):
        st.dataframe(
            format_ratio_columns(
                ratio_df[["ì±„ë„","ë§¤ì¶œì›ê°€ìœ¨","ë§¤ì¶œì´ì´ìµë¥ ","ìš´ì˜ë¹„ìš©ë¥ "]],
                ["ë§¤ì¶œì›ê°€ìœ¨","ë§¤ì¶œì´ì´ìµë¥ ","ìš´ì˜ë¹„ìš©ë¥ "]
            ),
            use_container_width=True
        )

    fig = build_chart(ratio_df)
    st.plotly_chart(fig, use_container_width=True)

    st.download_button(
        label="ğŸ“¥ ì±„ë„ë³„ ë¹„ìœ¨ CSV ë‹¤ìš´ë¡œë“œ",
        data=ratio_df.to_csv(index=False, encoding="utf-8-sig"),
        file_name="channel_ratio_summary.csv",
        mime="text/csv"
    )

st.caption("Â© ì±„ë„ë³„ ì†ìµ ë¹„ìœ¨ ëŒ€ì‹œë³´ë“œ â€¢ í†µì¼ëœ í…Œë§ˆ â€¢ Plotly + Streamlit â€¢ ë§‘ì€ ê³ ë”• í°íŠ¸ ì ìš©")
ğŸ’¡ ì´ì œ ë³„ë„ config.toml íŒŒì¼ í•„ìš” ì—†ì´, ì´ í•˜ë‚˜ì˜ ì½”ë“œ(app.py) ë§Œ ì‹¤í–‰í•˜ë©´ í…Œë§ˆ(ë°°ê²½ìƒ‰Â·í°íŠ¸Â·ë²„íŠ¼ìƒ‰ ë“±)ì™€ ì°¨íŠ¸ ìƒ‰ìƒì´ í†µì¼ë©ë‹ˆë‹¤.

ğŸ‘‰ í˜¹ì‹œ ì›í•˜ì‹œëŠ” ì¶”ê°€ ìœ„ì ¯ í…Œë§ˆ(ì˜ˆ: í‘œ í…Œë‘ë¦¬, ìŠ¬ë¼ì´ë” ìƒ‰ìƒ ë“±)ë„ ì´ ì½”ë“œì— í¬í•¨í•´ë“œë¦´ê¹Œìš”?

ë‚˜ì˜ ë§:
2025-08-21 17:12:37.733 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
ChatGPTì˜ ë§:
ì¢‹ì€ ì§€ì ì´ì—ìš” ğŸ‘
ì§€ê¸ˆ ë³´ì‹  ë©”ì‹œì§€:

2025-08-21 17:12:37.733 Thread 'MainThread': missing ScriptRunContext! 
This warning can be ignored when running in bare mode.
ì´ê±´ Streamlit ë‚´ë¶€ ê²½ê³ ì¸ë°, ë³´í†µ ë‘ ê°€ì§€ ìƒí™©ì—ì„œ ë‚˜ì˜µë‹ˆë‹¤:

âœ… ë°œìƒ ì›ì¸
PyCharmì—ì„œ ê·¸ëƒ¥ python app.py ì‹¤í–‰í•œ ê²½ìš°

Streamlitì€ ë‹¨ìˆœ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ì²˜ëŸ¼ ì‹¤í–‰í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, ìì²´ ì„œë²„ë¥¼ ë„ì›Œì„œ ì›¹ë¸Œë¼ìš°ì € ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ë™í•´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë˜ì„œ python app.pyë¡œ ì‹¤í–‰í•˜ë©´ ì´ëŸ° ê²½ê³ ê°€ ë‚˜ì˜¤ê³ , UIë„ ì•ˆ ëœ¨ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

Streamlitì˜ st ê°ì²´ë¥¼ ìºì‹±í•˜ê±°ë‚˜ ì™¸ë¶€ ìŠ¤ë ˆë“œì—ì„œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°

í•˜ì§€ë§Œ ì§€ê¸ˆ ì‘ì„±í•˜ì‹  ì½”ë“œëŠ” ë‹¨ì¼ ìŠ¤ë ˆë“œë¼ì„œ 1ë²ˆì´ ì›ì¸ì¼ í™•ë¥ ì´ 99%ì…ë‹ˆë‹¤.

âœ… í•´ê²° ë°©ë²•
í„°ë¯¸ë„(ë˜ëŠ” PyCharmì˜ í„°ë¯¸ë„ íƒ­)ì—ì„œ ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”:

streamlit run app.py
ê·¸ëŸ¬ë©´ ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¬ë©´ì„œ http://localhost:8501 ì£¼ì†Œì—ì„œ ëŒ€ì‹œë³´ë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

ğŸ”§ PyCharmì—ì„œ ë°”ë¡œ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ë©´
Run/Debug Configurationsì— ê°€ì„œ:

Script path ëŒ€ì‹  Module nameì„ ì„ íƒí•˜ê³ 

streamlitì„ ì…ë ¥í•œ ë’¤

Parametersì— run app.pyë¥¼ ì ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.

ì¦‰ PyCharmì—ì„œ ì‹¤í–‰í•  ë•Œë„ ì‹¤ì œë¡œëŠ”:

python -m streamlit run app.py
ì´ëŸ° ì‹ìœ¼ë¡œ ëŒë¦¬ë„ë¡ ì„¤ì •í•´ì•¼ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.

ğŸ‘‰ ì§ˆë¬¸: ì§€ê¸ˆ PyCharmì—ì„œ python app.pyë¡œ ì‹¤í–‰í•˜ì‹  ê±´ê°€ìš”, ì•„ë‹ˆë©´ streamlit run app.pyë¡œ ì‹¤í–‰í•˜ì…¨ë‚˜ìš”?




ì„ íƒëœ íŒŒì¼ ì—†ìŒì„ íƒëœ íŒŒì¼ ì—†ìŒ
ChatGPTëŠ” ì‹¤ìˆ˜ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¤‘ìš”í•œ ì •ë³´ëŠ” ì¬ì°¨ í™•ì¸í•˜ì„¸ìš”.
